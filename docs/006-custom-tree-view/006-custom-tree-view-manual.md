# 自定义树视图用户操作手册

## 目录

1. [功能概述](#功能概述)
2. [快速入门](#快速入门)
3. [视图管理](#视图管理)
4. [节点管理](#节点管理)
5. [CI 查询与筛选](#ci-查询与筛选)
6. [权限管理](#权限管理)
7. [常见问题](#常见问题)

---

## 功能概述

自定义树视图是 CMDB 系统的重要功能模块，允许管理员创建灵活的树形结构来组织和展示 CI（配置项）数据。

### 主要功能

- **自定义视图**：创建多个独立的视图，如"服务器视图"、"网络设备视图"等
- **树形节点**：支持多级节点结构，最多 5 层
- **条件筛选**：每个节点可配置筛选条件，动态展示符合条件的 CI
- **权限控制**：基于角色的节点级权限管理
- **CI 操作**：支持查看、编辑、复制、删除、批量操作 CI
- **导入导出**：支持 CI 数据的批量导入和导出

### 使用场景

- **按地理位置组织**：如"广州机房"→"数据库服务器"→"Oracle 数据库"
- **按业务系统组织**：如"电商系统"→"订单服务"→"数据库"
- **按部门组织**：如"IT 部门"→"服务器组"→"生产服务器"

---

## 快速入门

### 1. 访问自定义视图

1. 登录系统后，在左侧菜单中找到"自定义视图"模块
2. 点击展开，查看有权限访问的视图列表
3. 点击视图名称，进入视图展示页面

### 2. 查看 CI 数据

1. 在左侧树形结构中，点击节点名称
2. 右侧会显示该节点筛选条件下的 CI 列表
3. 可以查看 CI 的详细属性信息

### 3. 搜索 CI

1. 在搜索框输入 CI 编码或名称关键字
2. 按回车或点击搜索按钮
3. 系统会筛选匹配的 CI 数据

---

## 视图管理

> **注意**：视图管理需要 `custom-view:manage` 权限

### 创建视图

1. 进入"系统管理"→"自定义视图管理"
2. 点击"新增视图"按钮
3. 填写视图信息：
   - **视图名称**：如"服务器视图"
   - **视图编码**：唯一标识，如"server-view"
   - **描述**：视图的用途说明
   - **图标**：选择视图图标
   - **排序**：视图的显示顺序
4. 点击"确定"保存

### 编辑视图

1. 在视图列表中找到要编辑的视图
2. 点击"编辑"按钮
3. 修改视图信息
4. 点击"确定"保存

### 删除视图

1. 在视图列表中找到要删除的视图
2. 点击"删除"按钮
3. 确认删除操作

> **警告**：删除视图会同时删除其所有节点和权限配置，请谨慎操作！

---

## 节点管理

### 创建节点

1. 进入视图展示页面或节点设计器
2. 选择父节点（如不选择则创建根节点）
3. 点击"新增节点"按钮
4. 填写节点信息：
   - **节点名称**：如"广州机房"
   - **排序顺序**：节点在同一层级的排序
   - **筛选配置**：设置 CI 筛选条件

#### 筛选配置说明

**模型选择**：
- 选择该节点要展示的 CI 模型，如"服务器"、"数据库"等

**筛选条件**：
- **字段**：选择模型属性字段
- **操作符**：选择比较方式
  - `等于`：精确匹配
  - `不等于`：排除匹配
  - `包含`：模糊匹配（常用）
  - `大于/小于`：数值比较
- **值**：输入筛选值

**示例**：
- 展示主机名包含"db"的数据库服务器：
  - 字段：`name`
  - 操作符：`包含`
  - 值：`db`

### 编辑节点

1. 在树形结构中右键点击节点，或点击节点后的"编辑"按钮
2. 修改节点信息
3. 点击"确定"保存

### 删除节点

1. 右键点击要删除的节点
2. 选择"删除"
3. 确认删除操作

> **注意**：删除节点会同时删除其所有子节点！

### 移动节点

1. 右键点击要移动的节点
2. 选择"移动"
3. 选择目标父节点（或选择"根节点"）
4. 点击"确定"

---

## CI 查询与筛选

### 基本搜索

1. **关键字搜索**：
   - 在搜索框输入 CI 编码或名称
   - 支持模糊匹配
   - 按回车或点击搜索按钮执行

2. **属性筛选**：
   - 选择属性字段（如"主机名"、"IP 地址"）
   - 输入属性值
   - 支持模糊匹配
   - 可同时设置多个筛选条件

### 高级筛选

#### 组合筛选

可以组合使用多种筛选方式：
- 关键字 + 属性筛选
- 多个属性条件组合
- 节点预设条件 + 动态筛选

#### 重置筛选

点击"重置"按钮，清除所有筛选条件，恢复默认列表。

### CI 列表操作

#### 列设置

1. 点击"列设置"按钮
2. 勾选要显示的列
3. 拖拽调整列顺序
4. 点击"确定"保存

#### 查看 CI 详情

1. 点击 CI 编码链接
2. 在抽屉中查看完整信息
3. 可以查看所有属性值

#### 编辑 CI

1. 点击"编辑"按钮
2. 修改属性值
3. 点击"保存"

#### 复制 CI

1. 点击"复制"按钮
2. 系统会创建一个新的 CI，复制原 CI 的属性值
3. 修改必要的信息
4. 点击"保存"

#### 删除 CI

1. 点击"删除"按钮
2. 确认删除操作

> **注意**：删除后不可恢复，请谨慎操作！

### 批量操作

#### 选择多个 CI

1. 勾选表格左侧的复选框
2. 可以选择当前页全部或部分 CI

#### 批量编辑

1. 选择多个 CI
2. 点击底部批量操作栏的"批量编辑"
3. 修改共同属性
4. 点击"保存"

#### 批量删除

1. 选择多个 CI
2. 点击"批量删除"
3. 确认删除操作

#### 导出选中

1. 选择多个 CI
2. 点击"导出选中"
3. 下载 Excel 文件

### 导入导出

#### 导出 CI

1. 点击"导出"按钮
2. 选择导出范围（全部或当前筛选结果）
3. 下载 Excel 文件

#### 导入 CI

1. 点击"导入"按钮
2. 下载导入模板
3. 按模板格式填写数据
4. 上传文件
5. 系统会验证数据并显示预览
6. 确认无误后点击"确认导入"

---

## 权限管理

> **注意**：权限管理需要 `custom-view:manage` 权限

### 视图级权限

1. 进入"系统管理"→"角色管理"
2. 选择要配置的角色
3. 在权限列表中找到"自定义视图"分类
4. 勾选视图权限：
   - `custom-view:{视图编码}:view` - 查看视图权限

### 节点级权限

1. 进入"系统管理"→"自定义视图权限"
2. 选择要配置的视图
3. 选择要授权的角色
4. 在节点树中勾选可访问的节点
5. 点击"保存"

#### 权限继承规则

- 授权父节点会自动授权所有子节点
- 子节点可以单独授权
- 用户只需拥有任一祖先节点的权限即可查看该节点

### 权限验证

1. 使用被授权的用户账号登录
2. 检查左侧菜单是否显示视图
3. 进入视图，检查是否能正常查看授权的节点
4. 检查未授权的节点是否不可见

---

## 常见问题

### Q1: 为什么创建了视图但菜单不显示？

**可能原因**：
- 视图未激活
- 当前用户没有视图查看权限
- 视图没有配置任何节点

**解决方法**：
1. 检查视图状态是否为"激活"
2. 联系管理员分配视图权限
3. 为视图添加至少一个节点

### Q2: 节点配置了筛选条件但 CI 列表为空？

**可能原因**：
- 筛选条件过于严格
- 模型选择错误
- 没有符合条件的 CI 数据

**解决方法**：
1. 检查筛选条件是否正确
2. 确认模型选择正确
3. 尝试放宽筛选条件
4. 检查 CMDB 中是否有对应模型的 CI 数据

### Q3: 为什么看不到某些节点？

**可能原因**：
- 没有该节点的查看权限
- 节点被禁用
- 父节点被禁用

**解决方法**：
1. 联系管理员确认权限配置
2. 检查节点状态

### Q4: 如何快速找到某个 CI？

**方法**：
1. 使用关键字搜索（支持 CI 编码和名称模糊匹配）
2. 使用属性筛选（如按 IP 地址、主机名筛选）
3. 组合使用多个筛选条件

### Q5: 导入失败怎么办？

**常见错误**：
- 文件格式不正确（必须使用 Excel 格式）
- 必填字段为空
- 数据格式错误
- 模型不存在

**解决方法**：
1. 下载最新模板，按模板格式填写
2. 检查必填字段是否完整
3. 检查数据格式（如日期、数值类型）
4. 确认模型编码正确

### Q6: 如何批量修改 CI 属性？

**步骤**：
1. 在列表中选择要修改的 CI
2. 点击"批量编辑"
3. 修改共同属性
4. 保存

### Q7: 节点树加载慢怎么办？

**说明**：
- 系统已添加缓存机制，首次加载后响应会更快
- 如果节点数量过多（超过 1000 个），建议优化节点结构

**优化建议**：
1. 合理规划节点层级，避免过深的嵌套
2. 禁用不常用的节点
3. 定期清理无用节点

### Q8: 如何复制一个视图？

**方法**：
1. 目前没有直接复制功能
2. 可以手动创建新视图
3. 参考原视图的节点结构，逐个创建节点
4. 复制筛选条件配置

---

## 最佳实践

### 视图规划

1. **按业务场景划分视图**：如服务器视图、网络视图、应用视图
2. **控制视图数量**：建议不超过 10 个，避免菜单过于复杂
3. **合理命名**：使用清晰、易懂的名称和编码

### 节点设计

1. **层级控制**：建议不超过 3-4 层，保持结构清晰
2. **节点命名**：使用统一的命名规范
3. **筛选条件**：
   - 避免过于复杂的条件
   - 优先使用"包含"操作符
   - 定期检查和优化筛选条件

### 权限管理

1. **最小权限原则**：只授予必要的节点权限
2. **角色划分**：按部门或职责划分角色
3. **定期审计**：定期检查权限配置

### 数据维护

1. **定期备份**：定期导出重要 CI 数据
2. **数据清理**：及时删除废弃的 CI 和节点
3. **性能监控**：关注大数据量下的查询性能

---

## 附录

### 支持的模型字段类型

| 字段类型 | 说明 | 筛选操作符 |
|----------|------|------------|
| 文本 | 单行文本 | 等于、不等于、包含、不包含 |
| 多行文本 | 多行文本 | 包含、不包含 |
| 数字 | 整数或小数 | 等于、不等于、大于、小于、大于等于、小于等于 |
| 日期 | 日期时间 | 等于、不等于、大于、小于 |
| 下拉选择 | 单选 | 等于、不等于、在列表中、不在列表中 |
| 多选 | 多选 | 在列表中、不在列表中 |
| IP 地址 | IP 地址 | 等于、不等于、包含 |

### 快捷键

| 快捷键 | 功能 |
|--------|------|
| Enter | 执行搜索 |
| Ctrl + R | 重置筛选 |
| Ctrl + E | 导出 |
| Ctrl + N | 新增 CI |

### 联系支持

如遇到问题，请联系：
- 系统管理员
- 技术支持团队
- 查看系统日志获取详细错误信息
