# CMDB 系统操作说明书（培训图文版）

版本：2026-02-15  
适用对象：CMDB 管理员、配置管理员、运维工程师、培训讲师  
系统地址：`http://localhost:3000`

## 0. 文档使用说明
本手册用于培训授课与新用户上手，采用“页面截图 + 编号标注 + 操作步骤 + 演练案例”结构。

截图存放目录约定：`/Users/peter/Documents/arco/docs/images/training/`

截图命名约定：
- `01-login.png`
- `02-home-menu.png`
- `03-dict-layout.png`
- `...`

标注约定：
- `①②③`：页面区域说明
- `步骤 1/2/3`：操作顺序
- `注意`：高频误操作提醒
- `演练`：培训时实操任务

---

## 1. 培训目标与角色分工

### 1.1 培训目标
完成培训后，学员应能独立完成：
1. 维护字典、模型、关系规则。
2. 录入 CI 并查看 CI 详情。
3. 在拓扑中定位节点、分析关系、跳转详情。
4. 处理常见问题（关键属性、附件、图片、权限等）。

### 1.2 角色建议
1. CMDB 管理员：配置字典、模型、关系类型、触发器。
2. 运维工程师：维护 CI、查看拓扑、处理关系。
3. 审计人员：查看日志审计与变更历史。

---

## 2. 快速上手流程（30 分钟）

### 2.1 路径概览
1. 字典管理：先准备模型类型、状态类字典。
2. 模型管理：配置模型、图标、关键属性、动态表单。
3. 关系类型：定义可建立的关系规则。
4. 配置仓库：录入 CI 并维护关系。
5. 拓扑视图：验证图标、关键属性与关系连线。
6. CI 详情：核对属性、附件/图片、关系拓扑。

### 2.2 培训建议节奏
1. 第 1 轮（讲师演示）：20 分钟。
2. 第 2 轮（学员实操）：30 分钟。
3. 第 3 轮（问题排查）：10 分钟。

---

## 3. 登录与首页

### 3.1 登录页面
![登录页](./images/training/01-login.png)

页面标注建议：
1. ① 用户名输入框
2. ② 密码输入框
3. ③ 登录按钮

操作步骤：
1. 输入账号：`admin`
2. 输入密码：`admin`
3. 点击登录进入首页

注意：
1. 连续密码错误可能触发安全限制（按系统配置）。
2. 登录后若菜单缺失，通常为权限未分配。

### 3.2 首页与菜单导航
![首页菜单](./images/training/02-home-menu.png)

页面标注建议：
1. ① 左侧一级菜单：配置管理 / CMDB / 系统管理
2. ② 顶部用户区域
3. ③ 右侧内容区

---

## 4. 配置管理模块

## 4.1 字典管理（重点）
路径：`配置管理 -> 字典管理`

![字典管理布局](./images/training/03-dict-layout.png)

页面标注建议：
1. ① 左侧字典类型树
2. ② `+` 新增字典类型
3. ③ `-` 删除字典类型
4. ④ 右侧字典项列表
5. ⑤ 字典项新增/编辑按钮

### 4.1.1 新增字典类型
操作步骤：
1. 点击左侧 `+`。
2. 填写字典名称、字典编码（建议英文小写下划线）。
3. 保存。

建议：
1. 模型类型字典固定使用 `mode_type`。
2. 编码投产后尽量不改，避免历史数据映射问题。

### 4.1.2 新增字典项（层级）
操作步骤：
1. 选中字典类型。
2. 点击“新增字典项”。
3. 填写字典项编码、显示名、父级（可选）。
4. 保存后在右侧列表确认层级。

规则说明：
1. 字典项由“编码 + 显示名”组成。
2. 支持树状层级。
3. 允许删除，但历史值保留，不强制清洗旧数据。

演练任务：
1. 新建 `mode_type`。
2. 新建字典项：`server(服务器)`、`database(数据库)`。

---

## 4.2 模型管理
路径：`配置管理 -> 模型管理`

![模型管理列表](./images/training/04-model-list.png)

页面标注建议：
1. ① 新增模型按钮
2. ② 模型列表
3. ③ 设计按钮
4. ④ 编辑按钮

### 4.2.1 新增模型
![模型编辑基础信息](./images/training/05-model-form-basic.png)

操作步骤：
1. 点击“新增模型”。
2. 填写模型名称、模型编码、目录。
3. 模型类型选择 `mode_type` 字典项。
4. 配置模型图标（内置或上传）。
5. 选择关键属性（最多 3 个）。
6. 保存。

关键规则：
1. 拓扑节点主标题显示 CI 名称。
2. 拓扑附加文本显示关键属性值。
3. 未配置关键属性时回退显示 CI 编码。

### 4.2.2 图标配置（可视化单选）
![模型图标选择](./images/training/06-model-icon-card.png)

说明：
1. 内置图标：使用 Ant Design 矢量图展示。
2. 自定义图标：上传图片后以卡片方式单选。
3. 同一时刻只能选择 1 个图标。

### 4.2.3 模型设计器
入口：模型列表点击“设计”

![模型设计器总览](./images/training/07-model-designer.png)

页面标注建议：
1. ① 左侧控件列表（默认 3 列响应式）
2. ② 中间画布
3. ③ 右侧属性配置
4. ④ 保存按钮

#### A. 属性分组控件
![属性分组控件](./images/training/08-group-control.png)

要点：
1. 字段拖入分组后，分组高度自动扩展。
2. 字段占用列数（24/12/8/6）在分组内外一致生效。
3. 分组可折叠，便于长表单阅读。

#### B. 下拉/单选/多选绑定字典
![字典字段配置](./images/training/09-select-dictionary.png)

操作步骤：
1. 选中字段（下拉/单选/多选）。
2. 在属性配置里选择“数据来源=字典”。
3. 选择字典类型。
4. 保存模型并预览。

#### C. 人员控件
![人员控件配置](./images/training/10-user-picker.png)

要点：
1. 人员字段支持从系统用户选择。
2. 可配置单选或多选。

#### D. 表格控件
![表格控件配置](./images/training/11-table-control.png)

要点：
1. 必须配置列定义。
2. 同一表格内列编码不能重复。
3. 保存前会进行结构校验。

演练任务：
1. 创建“服务器模型”，字段含主机名、IP、负责人、图片、附件。
2. 创建“数据库模型”，字段含数据库名、版本、所属主机。

---

## 4.3 关系类型
路径：`配置管理 -> 关系类型`

![关系类型](./images/training/12-relation-type.png)

操作步骤：
1. 新增关系类型（如“主机-数据库”）。
2. 设定方向、适用模型范围。
3. 保存并在 CI 关系中验证可用性。

建议：
1. 关系命名采用“源-目标”规范。
2. 先定义主干关系，再扩展次级关系。

---

## 4.4 关系触发器
路径：`配置管理 -> 关系触发器`

![关系触发器](./images/training/13-relation-trigger.png)

操作步骤：
1. 新增触发器。
2. 指定触发模型、触发字段或规则。
3. 设置目标关系类型。
4. 保存后通过 CI 更新动作验证自动建关系。

---

## 5. CMDB 模块

## 5.1 配置仓库（CI 列表）
路径：`CMDB -> 配置仓库`

![CI列表页](./images/training/14-ci-list.png)

页面标注建议：
1. ① 模型树
2. ② 搜索与筛选区
3. ③ 功能按钮区（新增/导入/导出/列设置）
4. ④ 列表数据区
5. ⑤ 分页区

已优化行为：
1. 顶部筛选与按钮区自适应换行，不再挤压重叠。
2. 关键属性列头显示红色 `*`（如 `*主机名`）。

### 5.1.1 CI 搜索
操作步骤：
1. 选择模型。
2. 输入关键词或设置筛选项。
3. 点击“搜索”。
4. 点击“重置”恢复默认条件。

### 5.1.2 新增 CI
![新增CI](./images/training/15-ci-create.png)

操作步骤：
1. 点击“新增CI”。
2. 按动态表单填写字段。
3. 保存后返回列表。

### 5.1.3 复制 CI
操作步骤：
1. 在列表行点击“复制”。
2. 修改必要字段并保存。
3. 系统创建新 CI，不覆盖原 CI。

### 5.1.4 导入/导出
操作建议：
1. 先导出模板再批量导入。
2. 导入前确认关键属性字段已填值。

---

## 5.2 CI 详情页
入口：CI 列表点击“查看”或点击 CI 编码

![CI详情总览](./images/training/16-ci-detail-tabs.png)

页面标注建议：
1. ① 基本信息
2. ② 属性信息
3. ③ 变更历史
4. ④ 关系管理

### 5.2.1 属性信息 Tab
![CI属性信息](./images/training/17-ci-attributes.png)

要点：
1. 按模型分组展示字段。
2. 关键属性名称带 `*` 标识。
3. 展示格式为“属性名：值”。

#### 图片字段展示
![图片字段](./images/training/18-ci-image-thumb.png)

规则：
1. 显示缩略图。
2. 点击后新窗口打开原图。

#### 附件字段展示
![附件字段](./images/training/19-ci-attachment.png)

规则：
1. 显示附件名称与大小。
2. 点击可下载。

### 5.2.2 变更历史 Tab
![变更历史](./images/training/20-ci-history.png)

用途：
1. 查看字段变更前后值。
2. 查看操作时间和操作人。

### 5.2.3 关系管理 Tab
![关系列表](./images/training/21-ci-relations-list.png)

要点：
1. 关系列表统一展示，不拆分双列表。
2. 支持新增、删除关系。

### 5.2.4 关系拓扑 Tab
![CI内拓扑](./images/training/22-ci-topology.png)

要点：
1. 图标与全局拓扑一致。
2. 连线与关系类型一致。
3. 点击节点可打开目标 CI 详情。

---

## 5.3 全局拓扑视图
路径：`CMDB -> 拓扑视图`

![全局拓扑](./images/training/23-topology-main.png)

页面标注建议：
1. ① 顶部筛选区（关键词、模型、起点等）
2. ② 节点列表
3. ③ 拓扑画布

当前展示规则：
1. 节点图标使用模型图标。
2. 内置图标为 Ant Design 矢量图。
3. 图上仅显示关键属性，不显示 CIID。
4. 节点列表仅显示关键属性，不显示 CIID。
5. 起点筛选按关键属性匹配。

交互操作：
1. 拖拽节点调整布局。
2. 鼠标滚轮缩放。
3. 点击节点打开 CI 详情。

演练任务：
1. 在拓扑中定位 `host1`。
2. 查看其关联 `db1`。
3. 点击 `db1` 跳转详情并核对属性。

---

## 5.4 全文搜索
路径：`CMDB -> 全文搜索`

![全文搜索](./images/training/24-fulltext-search.png)

用途：
1. 跨模型按关键字查找 CI。
2. 快速定位资产并跳转详情。

---

## 5.5 变更历史
路径：`CMDB -> 变更历史`

![全局变更历史](./images/training/25-global-history.png)

用途：
1. 查看全局 CI 变更轨迹。
2. 支持按时间和对象筛选。

---

## 6. 系统管理模块

## 6.1 用户管理
路径：`系统管理 -> 用户管理`

![用户管理](./images/training/26-user.png)

常用操作：
1. 新增/禁用用户。
2. 绑定部门与角色。

## 6.2 角色管理
路径：`系统管理 -> 角色管理`

![角色管理](./images/training/27-role.png)

常用操作：
1. 为角色分配菜单权限和操作权限。
2. 排查“看不到菜单/按钮”问题。

## 6.3 部门管理
路径：`系统管理 -> 部门管理`

![部门管理](./images/training/28-department.png)

## 6.4 系统配置
路径：`系统管理 -> 系统配置`

![系统配置](./images/training/29-system-config.png)

## 6.5 日志审计
路径：`系统管理 -> 日志审计`

![日志审计](./images/training/30-log-audit.png)

说明：
1. 记录关键增删改操作。
2. 查询类视图（`cmdb_model`、`model_category`）不记录 VIEW 日志，用于节省空间。

---

## 7. 典型培训案例（建议现场演示）

### 案例 A：从 0 到 1 建模并上图
1. 新建字典 `mode_type`。
2. 新建模型“服务器”“数据库”。
3. 配置关键属性（服务器：主机名；数据库：数据库名）。
4. 在配置仓库新增 `host1` 和 `db1`。
5. 建立“主机-数据库”关系。
6. 在拓扑视图验证图标、关键属性、连线和跳转。

### 案例 B：CI 详情文件字段验证
1. 在 CI 表单上传图片与附件。
2. 打开 CI 详情 -> 属性信息。
3. 验证图片缩略图与新窗口打开。
4. 验证附件名称/大小与下载。

### 案例 C：权限排查
1. 用普通角色账号登录。
2. 观察菜单缺失。
3. 管理员在角色管理补权限。
4. 重新登录验证。

---

## 8. 常见问题与处理

### 8.1 模型类型下拉为空
原因：`mode_type` 字典未配置。  
处理：先在字典管理创建 `mode_type` 及字典项。

### 8.2 拓扑显示“未配置关键属性”
原因：模型关键属性字段已改动或历史数据为空。  
处理：核对字段编码并补齐历史 CI 数据。

### 8.3 附件下载失败
原因：历史附件字段格式异常或文件缺失。  
处理：检查附件值结构、下载路径映射、磁盘文件是否存在。

### 8.4 图片打开 404
原因：文件路径失效或文件不存在。  
处理：检查 `backend/uploads` 文件、重传图片并验证新路径。

### 8.5 页面操作按钮“挤在一起”
处理：已支持响应式换行；若仍异常，清缓存并确认浏览器缩放比例为 100%。

---

## 9. 培训讲师使用建议
1. 先讲“业务目标”，再演示“标准流程”。
2. 演示时固定按“字典 -> 模型 -> CI -> 关系 -> 拓扑 -> 详情”的顺序。
3. 每讲完一个模块，立即让学员完成一个小演练。
4. 培训结束前留 10 分钟做 FAQ 排查演练。

---

## 10. 版本记录
- 2026-02-15：重写为培训图文版，覆盖字典、模型、关系、CI、拓扑、系统管理全流程，补充页面标注与实操案例。
